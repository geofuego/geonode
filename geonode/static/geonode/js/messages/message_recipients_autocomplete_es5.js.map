{"version":3,"file":"message_recipients_autocomplete_es5.js","names":["get_users_data","data","objects","map","elem","value","username","id","get_groups_data","title","MessageRecipientsTags","input","data_extract_func","url","blacklist","arguments","length","undefined","_classCallCheck","tagName","type","Error","tagify","request_controller","_createClass","key","init","Tagify","whitelist","on","_onInputHandler","bind","AbortController","event","_this","detail","settings","loading","dropdown","hide","call","abort","fetch","signal","then","response","json","res","_this$tagify$settings","filter","includes","splice","apply","concat","_toConsumableArray","show","fixOutputValue","_this2","JSON","parse","forEach","$","attr","name","appendTo","disabled"],"sources":["message_recipients_autocomplete.js"],"sourcesContent":["function get_users_data(data) {\n    return data.objects.map((elem) => {\n        return {value: elem.username, id: elem.id};\n    });\n}\n\nfunction get_groups_data(data) {\n    return data.objects.map((elem) => {\n        return {value: elem.title, id: elem.id};\n    });\n}\n\nclass MessageRecipientsTags {\n    constructor(input, data_extract_func, url, blacklist = []) {\n        if (input.tagName !== 'INPUT' || input.type !== 'text') {\n            throw Error('Base element should be <input type=\"text\">');\n        }\n        this.input = input;\n        this.tagify = null;\n        this.data_extract_func = data_extract_func;\n        this.url = url;\n        this.blacklist = blacklist;\n        this.request_controller = null;\n    }\n\n    init() {\n        this.tagify = new Tagify(this.input, {whitelist: [], blacklist: this.blacklist});\n        this.tagify.on('input', this._onInputHandler.bind(this));\n        this.request_controller = new AbortController();\n    }\n\n\n    _onInputHandler(event) {\n        const value = event.detail.value;\n        this.tagify.settings.whitelist.length = 0;\n\n        this.tagify.loading(true).dropdown.hide.call(this.tagify);\n        this.request_controller.abort();\n        this.request_controller = new AbortController();\n\n        fetch(this.url + value, {signal:this.request_controller.signal}).then(response =>\n            response.json()\n                .then(this.data_extract_func)\n                .then(res => {\n                    res = res.filter(elem => {\n                        if (!(this.blacklist.includes(elem.value))) {\n                            return elem;\n                        }\n                    });\n                    this.tagify.settings.whitelist.splice(0, res.length, ...res);\n                    this.tagify.loading(false).dropdown.show.call(this.tagify, value);\n                }));\n    }\n\n    fixOutputValue() {\n        if (this.input.value !== '') {\n            JSON.parse(this.input.value).filter(elem => 'id' in elem).forEach((elem) => {\n                $('<input>').attr({\n                    type: 'hidden',\n                    id: 'foo',\n                    name: this.input.name,\n                    value: elem.id\n                }).appendTo('form');\n            });\n        }\n        this.input.disabled = true;\n    }\n}\n\n"],"mappings":"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","ignoreList":[]}