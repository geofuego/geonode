{"version":3,"file":"crop_widget_es5.js","names":["IDS_VALUT","SEND_B_ID","CANCEL_B_ID","OK_B_ID","DISMISS_B_ID","GRAIN_WRAP_ID","FILE_INPUT_ID","WORKSPACE_ID","WORKSPACE_CONTAINER_ID","MODAL_OVERLAY_ID","FILE_LABEL_ID","ThumbnailService","document_id","get_path","_classCallCheck","_createClass","key","value","postThumbnail","base64_url","formData","FormData","append","_b64toBlob","url","location","origin","String","$","ajax","data","type","contentType","processData","headers","_getCookie","success","reload","error","Error","name","document","cookie","parts","split","length","pop","shift","getThumbnail","image_element","callback","arguments","undefined","thumbnail_url","src","b64Data","sliceSize","byteCharacters","atob","byteArrays","offset","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","push","Blob","CssManager","makeVisible","dom_elem_id","removeClass","makeImvisible","addClass","change_modal_visibility","val","DomBuilder","widget_grain","wrap","concat","grain_wrapper","prepend","_create_flow_buttons","create_workspace","workspace_html","body","CropTask","dom_builder","css_manager","data_service","previous_image","init_cropper","cropper","Cropper","aspectRatio","crop","event","set_previous_image","image_src","init","on","load_start_image","bind","dismiss_current_image","apply_current_image","cancel_cropping","send_cropped_image","file_event","_this","window","File","FileReader","FileList","target","files","file","fr","onload","e","destroy","attr","result","onloadend","readAsDataURL","_clear_input","h","height","w","width","getCroppedCanvas","toDataURL","CropWidget","element","prefetch_image","tagName","service"],"sources":["crop_widget.js"],"sourcesContent":["const IDS_VALUT = {\n    SEND_B_ID: 'id_crop_save_button',\n    CANCEL_B_ID: 'id_crop_cancel_button',\n    OK_B_ID: 'id_crop_ok_button',\n    DISMISS_B_ID: 'id_crop_dismiss_button',\n    GRAIN_WRAP_ID: 'id_crop_entry',\n    FILE_INPUT_ID: 'id_crop_file',\n    WORKSPACE_ID: 'id_crop_modal_workspace',\n    WORKSPACE_CONTAINER_ID: 'id_crop-modal-container',\n    MODAL_OVERLAY_ID: 'id_crop-modal-overlay',\n    FILE_LABEL_ID: 'id_crop-file-label'\n}\n\n\nclass ThumbnailService {\n\n    constructor(document_id, get_path) {\n        this.document_id = document_id;\n        this.get_path = get_path;\n    }\n\n    postThumbnail(base64_url) {\n        const formData = new FormData();\n        formData.append(\"file\", this._b64toBlob(base64_url), 'blob.png');\n        const url = location.origin + '/api/v2/resources/' + String(this.document_id) + '/set_thumbnail';\n        $.ajax({\n            url: url,\n            data: formData,\n            type: 'PUT',\n            contentType: false,\n            processData: false,\n            headers: {\n                \"X-CSRFToken\": this._getCookie('csrftoken')\n            },\n            success: () => {\n                location.reload();\n            },\n            error: () => {\n                throw Error('Cannot upload new thumbnail');\n            }\n        });\n    }\n\n    _getCookie(name) {\n        const value = \"; \" + document.cookie;\n        const parts = value.split(\"; \" + name + \"=\");\n        if (parts.length === 2) {\n            return parts.pop().split(\";\").shift();\n        }\n    }\n\n    getThumbnail(image_element, callback = null) {\n        const url = location.origin + this.get_path + String(this.document_id);\n        return $.ajax({\n            url: url,\n            type: 'GET',\n            contentType: false,\n            processData: false,\n            headers: {\n                \"X-CSRFToken\": this._getCookie('csrftoken')\n            },\n            success: (data) => {\n                if (data && data.thumbnail_url) {\n                    image_element.src = data.thumbnail_url;\n                } else {\n                    image_element.src = '/static/geonode/img/missing_thumb.png';\n                }\n                if (callback !== null) {\n                    callback();\n                }\n            },\n            error: () => {\n                image_element.src = '/static/geonode/img/missing_thumb.png';\n            }\n        });\n\n    }\n\n    _b64toBlob(b64Data, contentType, sliceSize = 512) {\n        contentType = contentType || '';\n        b64Data = b64Data.split(',')[1];\n\n        const byteCharacters = atob(b64Data);\n        const byteArrays = [];\n\n        for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n            const slice = byteCharacters.slice(offset, offset + sliceSize);\n\n            const byteNumbers = new Array(slice.length);\n            for (let i = 0; i < slice.length; i++) {\n                byteNumbers[i] = slice.charCodeAt(i);\n            }\n\n            const byteArray = new Uint8Array(byteNumbers);\n\n            byteArrays.push(byteArray);\n        }\n\n        return new Blob(byteArrays, {type: contentType});\n    }\n}\n\nclass CssManager {\n\n    makeVisible(dom_elem_id) {\n        $('#' + dom_elem_id).removeClass('invisible');\n    }\n\n    makeImvisible(dom_elem_id) {\n        $('#' + dom_elem_id).addClass('invisible');\n    }\n\n    change_modal_visibility() {\n        if ($('#' + IDS_VALUT.FILE_INPUT_ID).val()) {\n            $('#' + IDS_VALUT.WORKSPACE_CONTAINER_ID).removeClass('invisible');\n            $('#' + IDS_VALUT.MODAL_OVERLAY_ID).removeClass('invisible');\n        } else {\n            $('#' + IDS_VALUT.WORKSPACE_CONTAINER_ID).addClass('invisible');\n            $('#' + IDS_VALUT.MODAL_OVERLAY_ID).addClass('invisible');\n        }\n    }\n}\n\nclass DomBuilder {\n    // class too manage building required dom to display cropper\n\n    constructor(widget_grain) {\n        this.widget_grain = widget_grain;\n        $(this.widget_grain).wrap(() => `<div id=${IDS_VALUT.GRAIN_WRAP_ID} class=crop-widget></div>`);\n        $(this.widget_grain).wrap(() => ``);\n\n        this.grain_wrapper = $('#' + IDS_VALUT.GRAIN_WRAP_ID);\n        this.grain_wrapper.append(`<div id=${IDS_VALUT.MODAL_OVERLAY_ID} class=\"crop-modal-overlay invisible\"></div>`);\n        this.grain_wrapper.prepend(`<div class=\"thumbnail-title\">Thumbnail</div>`);\n\n    }\n\n    _create_flow_buttons() {\n        this.grain_wrapper.append(`<input type=file id=${IDS_VALUT.FILE_INPUT_ID} name=files class=crop-input /> `);\n        this.grain_wrapper.append(`<label id=${IDS_VALUT.FILE_LABEL_ID} for=${IDS_VALUT.FILE_INPUT_ID} class=\"btn btn-default crop-input-label\">Choose file</label>`);\n        this.grain_wrapper.append(`<button type=button id=${IDS_VALUT.SEND_B_ID} class=\\\"btn btn-default invisible\\\">Save</button><button type=button id=${IDS_VALUT.CANCEL_B_ID} class=\"btn btn-default invisible\">Cancel</button>`);\n\n    }\n\n    create_workspace() {\n        const workspace_html = `\n                              <div id=${IDS_VALUT.WORKSPACE_CONTAINER_ID} class=\"crop-modal-container invisible\">                                  \n                                  <img id=${IDS_VALUT.WORKSPACE_ID} class=\"crop-modal-workspace\">                                      \n                                  <button type=button id=${IDS_VALUT.OK_B_ID} class=\"btn btn-default\">OK</button><button type=button id=${IDS_VALUT.DISMISS_B_ID} class=\"btn btn-default\">Dismiss</button>                                      \n                              </div>`;\n\n\n        $(document.body).append(workspace_html);\n        this._create_flow_buttons();\n\n    }\n\n}\n\nclass CropTask {\n\n    constructor(dom_builder, css_manager, data_service) {\n        this.dom_builder = dom_builder;\n        this.css_manager = css_manager;\n        this.previous_image = null;\n        this.data_service = data_service;\n    }\n\n    init_cropper() {\n        this.cropper = new Cropper($('#' + IDS_VALUT.WORKSPACE_ID)[0], {\n            aspectRatio: 4 / 3,\n            crop(event) {\n            },\n        });\n    }\n\n    set_previous_image(image_src) {\n        this.previous_image = image_src;\n    }\n\n    init() {\n        this.dom_builder.create_workspace();\n        $('#' + IDS_VALUT.FILE_INPUT_ID).on('change', this.load_start_image.bind(this));\n        $('#' + IDS_VALUT.DISMISS_B_ID).on('click', this.dismiss_current_image.bind(this));\n        $('#' + IDS_VALUT.OK_B_ID).on('click', this.apply_current_image.bind(this));\n\n        $('#' + IDS_VALUT.CANCEL_B_ID).on('click', this.cancel_cropping.bind(this));\n        $('#' + IDS_VALUT.SEND_B_ID).on('click', this.send_cropped_image.bind(this));\n        this.previous_image = this.dom_builder.widget_grain.src;\n    }\n\n    load_start_image(file_event) {\n        if (window.File && window.FileReader && window.FileList && window.Blob) {\n\n            if (file_event.target.files.length) {\n                const file = file_event.target.files[0];\n                const fr = new FileReader();\n\n                fr.onload = (e) => {\n                    if (this.cropper) {\n                        this.cropper.destroy();\n                    }\n                    $('#' + IDS_VALUT.WORKSPACE_ID).attr('src', e.target.result);\n\n                }\n                fr.onloadend = (e) => {\n                    this.init_cropper();\n                    this.css_manager.change_modal_visibility();\n                };\n                fr.readAsDataURL(file);\n\n\n            }\n        } else {\n            throw Error('FileAPI is not supported');\n        }\n    }\n\n    _clear_input() {\n        $('#' + IDS_VALUT.FILE_INPUT_ID).val('');\n    }\n\n    dismiss_current_image() {\n        this._clear_input();\n        this.cropper.destroy();\n        this.css_manager.change_modal_visibility();\n\n    }\n\n    apply_current_image() {\n        const h = this.dom_builder.widget_grain.height;\n        const w = this.dom_builder.widget_grain.width;\n        $(this.dom_builder.widget_grain).attr('src', this.cropper.getCroppedCanvas({\n            width: 400,\n        }).toDataURL());\n        $(this.dom_builder.widget_grain).attr('height', h);\n        $(this.dom_builder.widget_grain).attr('width', w);\n        this.css_manager.makeImvisible(IDS_VALUT.FILE_LABEL_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.FILE_INPUT_ID);\n        this.css_manager.makeVisible(IDS_VALUT.SEND_B_ID);\n        this.css_manager.makeVisible(IDS_VALUT.CANCEL_B_ID);\n        this.cropper.destroy();\n        this._clear_input();\n        this.css_manager.change_modal_visibility();\n    }\n\n    cancel_cropping() {\n        $(this.dom_builder.widget_grain).attr('src', this.previous_image);\n        this._clear_input();\n        this.css_manager.makeImvisible(IDS_VALUT.CANCEL_B_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.SEND_B_ID);\n        this.css_manager.makeVisible(IDS_VALUT.FILE_INPUT_ID);\n        this.css_manager.makeVisible(IDS_VALUT.FILE_LABEL_ID);\n    }\n\n    send_cropped_image() {\n        this.set_previous_image(this.dom_builder.widget_grain.src);\n        this.data_service.postThumbnail(this.previous_image)\n        this.css_manager.makeVisible(IDS_VALUT.FILE_INPUT_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.SEND_B_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.CANCEL_B_ID);\n    }\n\n\n}\n\n\nclass CropWidget {\n\n    /**\n     *\n     * @param element: img html DOM element, widget grain and final destination\n     * @param document_id id of resource. is used to build get and post requests\n     * @param get_path: api endpoint path to get current thumbnail\n     * @param prefetch_image: in case current/previous thumbnail is not API accessible provide its static url\n     *\n     */\n    constructor(element, document_id, get_path, prefetch_image = null) {\n        this.element = element;\n        if (this.element.tagName !== 'IMG') {\n            throw Error('Base element should be <img>');\n        }\n        this.dom_builder = new DomBuilder(this.element);\n        this.css_manager = new CssManager();\n        this.service = new ThumbnailService(document_id, get_path);\n        this.crop = null;\n        this.prefetch_image = prefetch_image;\n    }\n\n    init() {\n        this.crop = new CropTask(this.dom_builder, this.css_manager, this.service);\n        if (this.prefetch_image === '') {\n            this.element.src = '/static/geonode/img/missing_thumb.png';\n            this.crop.init();\n        } else if (this.prefetch_image === null || this.prefetch_image === undefined) {\n            this.service.getThumbnail(this.element, this.crop.init.bind(this.crop));\n        } else {\n            this.element.src = this.prefetch_image;\n            this.crop.init();\n        }\n    }\n}\n\n\n"],"mappings":"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","ignoreList":[]}